name = "llm-observatory"
account_id = "facf6619808dc039df729531bbb26d1d"
main = "src/index.ts"
compatibility_date = "2025-01-09"
compatibility_flags = ["nodejs_compat"]
workers_dev = true
preview_urls = true

[build]
command = "npm run build:frontend"

# Custom domains
[[routes]]
pattern = "observatory.emilycogsdill.com"
custom_domain = true

[[routes]]
pattern = "llm.emilycogsdill.com"
custom_domain = true

[ai]
binding = "AI"
remote = true

[assets]
directory = "./dist"
not_found_handling = "single-page-application"
binding = "ASSETS"
run_worker_first = true

[[d1_databases]]
binding = "DB"
database_name = "llm-observatory-db"
database_id = "43f364e4-fd30-4ddf-b068-de171232eddf"

# DO class kept for Cloudflare compatibility (scheduling moved to Dagster)
# The class does nothing - it just returns 410 Gone
[[migrations]]
tag = "v1"
new_classes = ["SwarmSchedulerDO"]

[dev]
port = 8787

# Note: Scheduling moved to Dagster. Cron triggers removed.
# Model sync now needs to be triggered manually or via Dagster.

[observability]
enabled = true
head_sampling_rate = 1

[vars]
BQ_PROJECT_ID = "emilys-personal-projects"
BQ_DATASET_ID = "llm_observatory"
BQ_TABLE_ID = "raw_responses"

# Secrets (set via wrangler secret put):
# OPENAI_API_KEY
# ANTHROPIC_API_KEY
# GOOGLE_API_KEY
# XAI_API_KEY
# DEEPSEEK_API_KEY
# BQ_SERVICE_ACCOUNT_EMAIL
# BQ_PRIVATE_KEY
# CF_ACCESS_TEAM_DOMAIN (e.g., https://your-team.cloudflareaccess.com)
# CF_ACCESS_AUD (your application's AUD tag from Access dashboard)
# ADMIN_API_KEY (for Bearer token auth on observation creation)

# ============================================
# Preview Environment (for PR deployments)
# ============================================
[env.preview]
name = "llm-observatory-preview"
workers_dev = true

# Preview uses same D1 database as production (read-only recommended)
[[env.preview.d1_databases]]
binding = "DB"
database_name = "llm-observatory-db"
database_id = "43f364e4-fd30-4ddf-b068-de171232eddf"

[env.preview.ai]
binding = "AI"

[env.preview.vars]
BQ_PROJECT_ID = "emilys-personal-projects"
BQ_DATASET_ID = "llm_observatory"
BQ_TABLE_ID = "raw_responses"

# No cron triggers for preview - we don't want previews running scheduled tasks
